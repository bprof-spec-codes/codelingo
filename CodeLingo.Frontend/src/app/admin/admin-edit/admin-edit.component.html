<div class="py-4 bg-dark text-white rounded shadow-sm">

  <h3 class="text-light mt-2 mb-2">{{ question ? 'Edit Question' : 'Create Question' }}</h3>
  <p *ngIf="!question" class="text-white-50">
    Fill the form below to create a new question.
  </p>

  <div *ngIf="question" class="mb-3 p-3 bg-secondary bg-opacity-10 rounded border border-secondary">
    <small class="text-secondary d-block mb-1">METADATA (Read-only)</small>
    <div class="row g-2 text-white-50 small">
      <div class="col-md-4"><strong>ID:</strong> {{ question.id }}</div>
      <div class="col-md-4"><strong>Created:</strong> {{ question.createdAt | date:'medium' }}</div>
      <div class="col-md-4"><strong>Updated:</strong> {{ question.updatedAt | date:'medium' }}</div>
      <div class="col-md-4"><strong>Created By:</strong> {{ question.createdBy }}</div>
    </div>
  </div>

  <form [formGroup]="questionForm" (ngSubmit)="saveQuestion()">

    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label class="form-label">Type</label>
        <select formControlName="type" class="form-select bg-dark text-white border-secondary">
          <option *ngFor="let t of (QuestionType | keyvalue)" [value]="t.value">{{ t.key }}</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Title</label>
        <input type="text" formControlName="title"
          class="form-control bg-dark text-white border-secondary placeholder-white"
          placeholder="Short, descriptive question title (e.g. Array sorting basics)" />
      </div>

      <div class="col-md-6">
        <label class="form-label">Language</label>
        <input type="text" formControlName="language"
          class="form-control bg-dark text-white border-secondary placeholder-white"
          placeholder="Programming language or technology (e.g. TypeScript, C#, SQL)" />
      </div>

      <div class="col-md-6">
        <label class="form-label">Difficulty</label>
        <select formControlName="difficulty" class="form-select bg-dark text-white border-secondary">
          <option value="Easy">Easy</option>
          <option value="Medium">Medium</option>
          <option value="Hard">Hard</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Question Text</label>
        <textarea formControlName="questionText"
          class="form-control bg-dark text-white border-secondary placeholder-white" rows="3"
          placeholder="Write the full question text here, including any code or context the learner needs."></textarea>
      </div>

      <div class="col-12">
        <label class="form-label">Explanation</label>
        <textarea formControlName="explanation"
          class="form-control bg-dark text-white border-secondary placeholder-white" rows="2"
          placeholder="Explain why the correct answer is right and common mistakes or misconceptions."></textarea>
      </div>

      <div class="col-md-6">
        <label class="form-label">Tags (comma separated)</label>
        <input type="text" formControlName="tags"
          class="form-control bg-dark text-white border-secondary placeholder-white"
          placeholder="e.g. arrays, loops, beginner, algorithms" />
      </div>

      <div formGroupName="metadata" class="col-md-6">
        <label class="form-label d-block">Metadata</label>

        <div class="mb-1">
          <input type="text" formControlName="category"
            class="form-control bg-dark text-white border-secondary mb-1 placeholder-white"
            placeholder="High-level category (e.g. Data Structures, OOP, Databases)" />
        </div>
        <div class="mb-1">
          <input type="text" formControlName="topic"
            class="form-control bg-dark text-white border-secondary mb-1 placeholder-white"
            placeholder="More specific topic (e.g. Arrays, LINQ, Async/Await)" />
        </div>
        <div>
          <input type="text" formControlName="source"
            class="form-control bg-dark text-white border-secondary placeholder-white"
            placeholder="Source or reference (e.g. Official docs, Blog post, Internal material)" />
        </div>
      </div>

      <div class="col-12 form-check mt-2 ms-2">
        <input type="checkbox" formControlName="isActive" class="form-check-input" id="isActive" />
        <label class="form-check-label" for="isActive">Active</label>
      </div>
    </div>

    <div *ngIf="questionForm.get('type')?.value === QuestionType.MultipleChoice" class="mb-3">
      <h5 class="mb-2">Multiple Choice Options</h5>

      <div formArrayName="options" class="mb-2">
        <div *ngFor="let opt of options.controls; let i = index" [formGroupName]="i"
          class="row g-1 align-items-center mb-1">
          <div class="col">
            <input formControlName="text" class="form-control bg-dark text-white border-secondary placeholder-white"
              [placeholder]="'Option ' + (i + 1) + ' text'" />
          </div>

          <div class="col-auto form-check form-switch ms-2">
            <input type="checkbox" formControlName="isCorrect" class="form-check-input"
              [id]="uniqueId + '-opt-correct-' + i" role="switch" />
            <label class="form-check-label" [for]="uniqueId + '-opt-correct-' + i">Correct</label>
          </div>

          <div class="col-auto">
            <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeOption(i)">
              Remove
            </button>
          </div>
        </div>

        <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addOption()">
          Add Option
        </button>
      </div>
    </div>

    <!-- Code Completion Section -->
    <div *ngIf="questionForm.get('type')?.value === QuestionType.CodeCompletion" class="mb-3">
      <h5 class="mb-2">Code Completion Details</h5>

      <div class="mb-3">
        <label class="form-label">Code Snippet (use _______ for blank)</label>
        <textarea formControlName="codeSnippet" class="form-control bg-dark text-white border-secondary font-monospace"
          rows="5" placeholder="e.g. console.log('Hello _______');"></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Accepted Answers</label>
        <div formArrayName="acceptedAnswers">
          <div *ngFor="let ans of acceptedAnswers.controls; let i = index" class="row g-1 align-items-center mb-1">
            <div class="col">
              <input [formControlName]="i" class="form-control bg-dark text-white border-secondary"
                [placeholder]="'Answer ' + (i + 1)" />
            </div>
            <div class="col-auto">
              <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeAcceptedAnswer(i)">
                Remove
              </button>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addAcceptedAnswer()">
          Add Answer
        </button>
      </div>
    </div>

    <button type="submit" class="btn btn-success">
      Save Question
    </button>
  </form>
</div>